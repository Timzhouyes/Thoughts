---
layout:     post   				    # 使用的布局（不需要改）
title:      学习Angular				# 标题 
subtitle:   官方Tutorial学习 #副标题
date:       2019-05-07				# 时间
author:     Haiming 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 编程
    - Angular
    - 记录
    - 学习
---

开始学习 Angular 。下面是对于官方教程之中自认为难点或者重点的梳理。

# 快速上手

1. Components are the fundamental building blocks of Angular applications.所以在 Angular 之中，承担功能的基本单位就是 Components。
2. 使用 Angular CLI 创建好项目之后，会默认创建一个 Angular 组件，是 `app-root`， 也叫做根组件。 

# 应用的“外壳”

这一章主要是讲如何修改页面的显示内容和样式。

在 `src/app` 这个文件夹下面有实现 AppComponent 的三个文件：

- app.component.ts : 组件的类代码，使用 TypeScript 写成
- app.component.html : 组件的模板，是使用 HTML 写成
- app.component.css : 组件的**私有** CSS 样式

#### 双花括号语法{{}}

`{{}}` 在 Angular 之中是插值绑定语法，其意为将组件的 title 属性的值绑定在 HTML 的某些标记之中。如下面的代码，就是把值绑定到 <h1> 标签之中

`<h1>{{title}}</h1>`

#### CSS 

在这章教程的CSS之中，可看出其提供的CSS一般包含：

- color
- font-family : 字体
- font- size: 字号



一般都是给某些限定的字体，比如

```css
h1 {
  color: #369;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 250%;
}
```

但是想要在这些标签之外默认字体设置怎么办？用下面的：

```css
/* everywhere else */
* {
  font-family: Arial, Helvetica, sans-serif;
}
```

`*` 就代表了默认的选项。

#### 总结

这一章之后，学会了：

- 使用 Angular CLI 创建初始应用结构
- 使用 Angular 组件显示数据
- 使用{{ }} 来插值。

# 1. 英雄编辑器

在命令行之中使用 `ng generate component heroes` 来新建组件， 名为 heroes。

新建组件之后，可以看到其新建四个文件，除了上面提到的三个，还有一个以`spec.ts` 结尾的测试文件，用于测试。

下面是`heroes.component.ts` 之中的部分代码：

```typescript
@Component({
  selector: 'app-heroes',
  templateUrl: './heroes.component.html',
  styleUrls: ['./heroes.component.css']
})
```

CLI 自动生成了三个元数据属性：

1. selector - 组件的选择器
2. templateUrl - 组件模板文件的位置
3. styleUrls - 组件私有 CSS 样式表文件的位置

其中 `app-heroes` 用来在父组件的模板之中匹配 HTML 元素的名称。也就是说，是用来在其他文件，例如在 `app.component.html` 之中插入的调用名称。

`ngOnInit()` 是一个生命周期钩子，在创建完组件之后就会调用，以完成复杂的初始化过程。

且一定要将这个 class export， 不然其他的地方没法使用。

#### 使用 UppercasePipe 格式化

在 Angular 之中，可以使用 Pipe 表达式来将其格式化。相当于是 pipe 符号左边的数据经过 Pipe 处理之后再流出管道。例如

` <h2>{{hero.name | uppercase}} Details</h2>`

就可以看作是 `hero.name` 经过 `uppercase` 之后其值变为大写再流出。

#### 双向绑定

```html
<div>
  <label>name:
    <input [(ngModel)]="hero.name" placeholder="name">
  </label>
</div>
```

此处使用`ngModel` 可以实现数据的双向绑定，但是不可以直接使用。原因是这个属于 `FormsModule` 下面的模块需要在 `app.module.ts` 之中注册。

首先是：

`import {FormsModule} from '@angular/forms';`

然后在下面的`ngModule` 里面在进行引入：

```typescript
@NgModule({
  declarations: [
    AppComponent,
    HeroesComponent
  ],
  imports: [
    BrowserModule,
    FormsModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
```

注意其中已经 imports 了这个 Module

# 2. 显示英雄列表

#### *ngFor 列出所有英雄

在<li> 标签之中使用 *ngFor 来列出所有英雄，其作用范围也是 <li> 标签。

```html
<h2>My Heroes</h2>>
<ul class="heroes">
    <li *ngFor="let hero of heroes" (click)="onSelect(hero)" [class.selected]="hero==selectedHero">
        <span class="badge">{{hero.id}}</span>{{hero.name}}
    </li>
</ul>
```

注意此处的 `<ul class="heroes">` 是为了下面的CSS 绑定做铺垫，而 `[class.selected]="hero==selectedHero"` 的作用我们之后再讲。

**千万不要忘记 ngFor 的星号**

#### 为什么一定要带星号？

看看下面代码有什么特别的？

```html
<div *ngIf="hero">{{hero}}</div>
<div *ngFor="let hero of heroes">{{hero}}</div>
```

上面指令名称有前缀星号（*），星号是一个语法糖，简化了 `ngIf` 和 `ngFor` 二者的读写，在模板引擎里最后还是会转换成 `<template>` 模式。

以下是 `ngIf` 语法糖与 `<template>` 的写法：

```html
<!-- Examples (A) and (B) are the same -->
<!-- (A) *ngIf paragraph -->
<p *ngIf="condition">
  Our heroes are true!
</p>

<!-- (B) [ngIf] with template -->
<template [ngIf]="condition">
  <p>
    Our heroes are true!
  </p>
</template>
```

只要不傻肯定用第一种写法。值得注意的是从A扩展到B，先将段落及其内容移到 `<template>` 标签里面，属性绑定部分作为 `<template>` 标签的指令。

接下来看看 `*ngFor` 是如何转换：

```html
<!-- Examples (A) and (B) are the same -->

<!-- (A) *ngFor div -->
<div *ngFor="let hero of heroes">{{ hero }}</div>

<!-- (B) ngFor with template -->
<template ngFor let-hero [ngForOf]="heroes">
  <div>{{ hero }}</div>
</template>
```

基本上和 `ngIf` 如出一辙；额外的细微是多了 `ngForOf` 属性绑定和 `hero` 本地模板变量。

#### 主从结构

当用户在主列表点击一个英雄时，该组件在页面底部显示所选英雄的详情。上面代码之中的`(click)="onSelect(hero)"` 就是一个事件绑定语法的例子。click 外面的圆括号会让 Angular 监听这个 <li> 元素的 click 事件，当用户点击 <li> 时， Angular 就会执行表达式 onSelect(hero)

#### 使用 *ngIf 隐藏空白的详情

一段代码块，如果不想让其产生作用，那么就使用<div>将其包裹起来，同时在标签内部使用 <div *ngIf>来作为条件判断。

#### 使用样式绑定

前面我们所提到的那段代码，`[class.selected]="hero==selectedHero"` ，其作用就是在我们的 HTML 之中将 CSS 之中已有的样式绑定上去。

其含义为将 CSS 之中的 “heroes.selected"(因为class是heroes) 绑定到hero和selectedHero 相同的Hero上面去，也就是点谁谁变。

#### 小结

个人小结：

在学习到这里的过程中，我个人认为，Angular 的纽带其实是模板，也就是HTML文件。模板通过绑定，可以连接到 Components 之中的方法， 可以使用 *ngIf 或者是\*ngFor 等等来进行条件筛选。Component更多的是提供逻辑模块或者是变量运算。样式的话 CSS 也是通过在模板页面进行引用来获得的。

官方小结：

- 可以选择一个英雄，并查看英雄的详情。
- 使用*ngFor 显示一个列表
- 使用 *ngIf 包含或者排除一段HTML
- 使用 class 绑定来切换 CSS 的样式类

# 3. 主从组件

这一节主要是讲如何将上一节之中提到过的 html 根据不同的功能分开，也就是将`app-hero` 和 `app-hero-details`放在不同的模块之中。这样做有：

- 可以单独修改 HeroesComponent 或者 HeroDetailComponent ，而不需要对其他组件进行变动。
- 可以在其他地方复用 HeroDetailComponent 。

#### 生成Component

`ng generate component hero-detail`

同样，会生成一个 ts 文件，一个 HTML 文件，一个专属的 CSS  文件，还有一个测试文件。与此同时，其会将 HeroDetailComponent 添加到 `src/app/app.module.ts` 之中的 @NgModule 的 declarations 之中。

#### 模板分割

将 HeroesComponent 的模板底部的 HTML 代码粘贴到生成的 HeroDetailComponent 之中。

由于在新的 Component 之中暂时没有 selectedHero 属性，所以要将其改成 Hero 。

`hero-detail-component.html`

```html
<div *ngIf="hero">

  <h2>{{hero.name | uppercase}} Details</h2>
  <div><span>id: </span>{{hero.id}}</div>
  <div>
    <label>name:
      <input [(ngModel)]="hero.name" placeholder="name"/>
    </label>
  </div>

</div>
```

#### 添加 @Input() hero 属性

因为要让我们的 HeroDetailComponent 被外部的 HeroesDetail 所使用，所以我们要在其中添加好 @Input() 的属性。同时因为上面已经将模板之中的所有 selectedHero 改成了 hero ， 所以我们还要在 ts 文件之中将 hero添加进去。

`hero-detail.component.ts`

```typescript
import { Component, OnInit,Input } from '@angular/core';
import {Hero} from '../hero';

@Component({
  selector: 'app-hero-detail',
  templateUrl: './hero-detail.component.html',
  styleUrls: ['./hero-detail.component.css']
})
export class HeroDetailComponent implements OnInit {

  @Input() hero:Hero;

  constructor() { }

  ngOnInit() {
  }

}

```

注意这里面我们说了要有 Input() 属性，所以在第一行的 `@angular/core` 之中要多加一个 Input 。下面的`  @Input() hero:Hero;` 即为将 hero 属性用 @Input 来修饰。

#### 修改 HeroesComponent 的模板

父子关系之中，要将父类的模板修改，使之可以使用子类。

在模板的最下面加入一行：

``<app-hero-detail [hero]="selectedHero"></app-hero-detail>``

其中的 `[hero]="selectedHero"` 是一种单向绑定语法。即从 HeroesComponent 的 selectedHero 属性绑定到目标元素的 hero 属性，并且映射到 HeroDetailComponent 的 hero 属性。

#### 小结

- 创立了一个独立的，可复用的 HeroDetailsComponent 组件
- 使用属性绑定将父组件 HeroesComponent 控制子组件 HeroDetailComponent
- 使用 @Input 装饰器使 hero 可以在外部被 HeroesComponent 绑定。

# 4.服务

